{"title":"Download MODIS data using CMR API in Python","markdown":{"yaml":{"title":"Download MODIS data using CMR API in Python","date":"2022-07-28","slug":"download-modis-data-using-cmr-api-in-python","categories":["Python"],"tags":[],"subtitle":"","lastmod":"2022-07-28T21:15:16+05:30","featured":"no","image":"featured.png"},"headingText":"To create a new environment","containsRefs":false,"markdown":"\n\nIf you have ever used USGS Earth Explorer to download / explore data, you’d notice that the manual process is cumbersome and not scalable. That is why we require a programmatic way to download satellite data.\n\nIn this blog we’d see how to download MODIS data using Python. We use a Python package called [modis-tools](https://github.com/fraymio/modis-tools) to perform our task. This package internally uses [NASA CMR](https://cmr.earthdata.nasa.gov/search/) (Common Metadata Repository) API which lets us search and query catalogs of various satellite dataset including MODIS.\n\nWe focus on the MODIS dataset in this blog, but with little modification, we could extend for various other datasets.\n\nBefore you move ahead, make sure you have an earthdata account. We would require the username and password to download the data. Register [here](https://urs.earthdata.nasa.gov/users/new) if not done so.\n\n---\n\nTo download the data we ask ourselves the following questions:\n\n1. Which dataset specifically do I need? — Define _Dataset Name_\n2. What area do I need the data for? — Define our _Region of Interest_\n3. What time period of data do I require? — Define _Start and End Date_\n\nHere, I wish to download MODIS Surface Reflectance 8-Day L3 Global 250 m SIN Grid data for Nigeria from 29 December, 2019 to 31st December, 2019.\n\nLet us install and use the Python package `modis-tools` to download the data on our local machine by performing the following steps\n\n1. Create a virtual environment.\n2. Install the `modis-tools` package.\n3. Write the code.\n\n\n\nCreate virtual environment `.modis-tools` using Python’s `venv`\n\n```\naman@AMAN-JAIN:~$ python3 -m venv .modis-tools\n```\n\nActivate the environment.\n\n```\naman@AMAN-JAIN:~$ source .modis-tools/bin/activate\n```\n\n**Note**: The above command is for linux. For Windows use .`modis-tools\\Scripts\\activate` instead.\n\n### Install the modis-tools package\n\n```\n(.modis-tools) aman@AMAN-JAIN:~$ pip install modis-tools\n```\n\n### Insert the below code\n\nPaste the code in a python file named `download.py`.\n\n```python\n# download_modis.py\n\n# 1) connect to earthdata\nsession = ModisSession(username=username, password=password)\n\n# 2) Query the MODIS catalog for collections\ncollection_client = CollectionApi(session=session)\ncollections = collection_client.query(short_name=\"MOD09GQ\", version=\"061\")\n# Query the selected collection for granules\ngranule_client = GranuleApi.from_collection(collections[0], session=session)\n\n# 3) Filter the selected granules via spatial and temporal parameters\nnigeria_bbox = [2.1448863675, 3.002583177, 4.289420717, 4.275061098] # format [x_min, y_min, x_max, y_max]\nnigeria_granules = granule_client.query(start_date=\"2019-12-29\", end_date=\"2019-12-31\", bounding_box=nigeria_bbox)\n\n# 4) Download the granules\nGranuleHandler.download_from_granules(nigeria_granules, session, threads=-1)\n```\n\nIn the above code, change the `username`, `password`, `nigeria_box` and `start_date` & `end_date` according to your requirements.\n\nTo explain the above code —\n\n- First we create a session, which makes a connection to earthdata and registers a session.\nNext three lines we search for MODIS Surface Reflectance 8-Day L3 Global 250 m SIN Grid dataset using `short_name` and `version`.\n\n- Now we filter the region spatially and temporally we want our data to be downloaded. In this example, we filter for the nigeria region with a bounding box (`bounding_box`) and the two days of december of 2019 (`start_date`, `end_date`).\n\n- Lastly, we download the data (granules) using multithreading, since we asked to use all threads. (`threads=-1` is all threads).\n\n### How to get `short_name` and `version` for the dataset?\n\n\nThe [collection endpoint](https://cmr.earthdata.nasa.gov/search/site/collections/) of the CMR API contains a directory of all dataset catalogs hosted by various organizations with its short name and version number. For MODIS data, LPDAAC_ECS hosts and maintains it. Under the `/collections/directory` endpoint, look for `LPDAAC_ECS` and search for the MODIS dataset you want to download. Each dataset has a short name and version associated with it as shown in the picture below. In our case we found `MOD09Q1` short name with version `061`.\n\n![](https://i.imgur.com/x9aT290.png)\n\n---\n\nNow it is time to run the code to see our data being downloaded.\n\nIn your terminal, run —\n\n```\n(.modis-tools) aman@AMAN-JAIN:~$ python download_modis.py\nDownloading: 100%|██████████████████████████████████████████████████████| 3/3 [00:10<00:00,  3.67s/file]\n```\nA progress bar would let you see the download progress and the files would be downloaded to your local disk. If you wish to download the data to a specific directory, use the path parameter in download_from_granules classmethod.\n\nEndnote\nThis short post on downloading MODIS data originated when I wanted to set up and deploy a pipeline. I did find other packages but they were quite old and did not use the state of the art specifications. Since the solution presented here uses CMR API, which has a very good documentation, I preferred it over other tools.\n\nYou can find the video version of this blog [here](https://youtu.be/3K1yl79Mhow)\n\n\n---\n\n### For the curious (Advanced)\n\nThe base url for the CMR API is —\n\n```sh\nhttps://cmr.earthdata.nasa.gov/search\n```\n\nInternally, CMR API first finds the collection for our dataset —\n\n```sh\nhttps://cmr.earthdata.nasa.gov/search/collections.json?short_name=MOD09GQ&version=061\n```\n\nAfter that the package queries the granules endpoint to find individual granules matching our query parameters —\n\n```sh\nhttps://cmr.earthdata.nasa.gov/search/granules.json?downloadable=true&scroll=true&page_size=2000&sort_key=-start_date&concept_id=C1621091662-LPDAAC_ECS&temporal=2019-12-01T00%3A00%3A00Z%2C2019-12-31T00%3A00%3A00Z&bounding_box=2.1448863675%2C3.002583177%2C4.289420717%2C4.275061098\n```\n\nNote that most parameters are autogenerated by the python package depending on the `short_name` and `version` you provide (downloadable, scroll, page_size, sort_key, concept_id). The other parameters are user defined (temporal, bounding_box)\n\nThere are many more additional parameters which can be passed. A complete list is present in the [documentation](https://cmr.earthdata.nasa.gov/search/site/docs/search/api.html). One such useful parameter that you can try out is `cloud_cover`. All you need to do is pass this parameter name with value to the `query` method in the above code.\n\n","srcMarkdownNoYaml":"\n\nIf you have ever used USGS Earth Explorer to download / explore data, you’d notice that the manual process is cumbersome and not scalable. That is why we require a programmatic way to download satellite data.\n\nIn this blog we’d see how to download MODIS data using Python. We use a Python package called [modis-tools](https://github.com/fraymio/modis-tools) to perform our task. This package internally uses [NASA CMR](https://cmr.earthdata.nasa.gov/search/) (Common Metadata Repository) API which lets us search and query catalogs of various satellite dataset including MODIS.\n\nWe focus on the MODIS dataset in this blog, but with little modification, we could extend for various other datasets.\n\nBefore you move ahead, make sure you have an earthdata account. We would require the username and password to download the data. Register [here](https://urs.earthdata.nasa.gov/users/new) if not done so.\n\n---\n\nTo download the data we ask ourselves the following questions:\n\n1. Which dataset specifically do I need? — Define _Dataset Name_\n2. What area do I need the data for? — Define our _Region of Interest_\n3. What time period of data do I require? — Define _Start and End Date_\n\nHere, I wish to download MODIS Surface Reflectance 8-Day L3 Global 250 m SIN Grid data for Nigeria from 29 December, 2019 to 31st December, 2019.\n\nLet us install and use the Python package `modis-tools` to download the data on our local machine by performing the following steps\n\n1. Create a virtual environment.\n2. Install the `modis-tools` package.\n3. Write the code.\n\n\n### To create a new environment\n\nCreate virtual environment `.modis-tools` using Python’s `venv`\n\n```\naman@AMAN-JAIN:~$ python3 -m venv .modis-tools\n```\n\nActivate the environment.\n\n```\naman@AMAN-JAIN:~$ source .modis-tools/bin/activate\n```\n\n**Note**: The above command is for linux. For Windows use .`modis-tools\\Scripts\\activate` instead.\n\n### Install the modis-tools package\n\n```\n(.modis-tools) aman@AMAN-JAIN:~$ pip install modis-tools\n```\n\n### Insert the below code\n\nPaste the code in a python file named `download.py`.\n\n```python\n# download_modis.py\n\n# 1) connect to earthdata\nsession = ModisSession(username=username, password=password)\n\n# 2) Query the MODIS catalog for collections\ncollection_client = CollectionApi(session=session)\ncollections = collection_client.query(short_name=\"MOD09GQ\", version=\"061\")\n# Query the selected collection for granules\ngranule_client = GranuleApi.from_collection(collections[0], session=session)\n\n# 3) Filter the selected granules via spatial and temporal parameters\nnigeria_bbox = [2.1448863675, 3.002583177, 4.289420717, 4.275061098] # format [x_min, y_min, x_max, y_max]\nnigeria_granules = granule_client.query(start_date=\"2019-12-29\", end_date=\"2019-12-31\", bounding_box=nigeria_bbox)\n\n# 4) Download the granules\nGranuleHandler.download_from_granules(nigeria_granules, session, threads=-1)\n```\n\nIn the above code, change the `username`, `password`, `nigeria_box` and `start_date` & `end_date` according to your requirements.\n\nTo explain the above code —\n\n- First we create a session, which makes a connection to earthdata and registers a session.\nNext three lines we search for MODIS Surface Reflectance 8-Day L3 Global 250 m SIN Grid dataset using `short_name` and `version`.\n\n- Now we filter the region spatially and temporally we want our data to be downloaded. In this example, we filter for the nigeria region with a bounding box (`bounding_box`) and the two days of december of 2019 (`start_date`, `end_date`).\n\n- Lastly, we download the data (granules) using multithreading, since we asked to use all threads. (`threads=-1` is all threads).\n\n### How to get `short_name` and `version` for the dataset?\n\n\nThe [collection endpoint](https://cmr.earthdata.nasa.gov/search/site/collections/) of the CMR API contains a directory of all dataset catalogs hosted by various organizations with its short name and version number. For MODIS data, LPDAAC_ECS hosts and maintains it. Under the `/collections/directory` endpoint, look for `LPDAAC_ECS` and search for the MODIS dataset you want to download. Each dataset has a short name and version associated with it as shown in the picture below. In our case we found `MOD09Q1` short name with version `061`.\n\n![](https://i.imgur.com/x9aT290.png)\n\n---\n\nNow it is time to run the code to see our data being downloaded.\n\nIn your terminal, run —\n\n```\n(.modis-tools) aman@AMAN-JAIN:~$ python download_modis.py\nDownloading: 100%|██████████████████████████████████████████████████████| 3/3 [00:10<00:00,  3.67s/file]\n```\nA progress bar would let you see the download progress and the files would be downloaded to your local disk. If you wish to download the data to a specific directory, use the path parameter in download_from_granules classmethod.\n\nEndnote\nThis short post on downloading MODIS data originated when I wanted to set up and deploy a pipeline. I did find other packages but they were quite old and did not use the state of the art specifications. Since the solution presented here uses CMR API, which has a very good documentation, I preferred it over other tools.\n\nYou can find the video version of this blog [here](https://youtu.be/3K1yl79Mhow)\n\n\n---\n\n### For the curious (Advanced)\n\nThe base url for the CMR API is —\n\n```sh\nhttps://cmr.earthdata.nasa.gov/search\n```\n\nInternally, CMR API first finds the collection for our dataset —\n\n```sh\nhttps://cmr.earthdata.nasa.gov/search/collections.json?short_name=MOD09GQ&version=061\n```\n\nAfter that the package queries the granules endpoint to find individual granules matching our query parameters —\n\n```sh\nhttps://cmr.earthdata.nasa.gov/search/granules.json?downloadable=true&scroll=true&page_size=2000&sort_key=-start_date&concept_id=C1621091662-LPDAAC_ECS&temporal=2019-12-01T00%3A00%3A00Z%2C2019-12-31T00%3A00%3A00Z&bounding_box=2.1448863675%2C3.002583177%2C4.289420717%2C4.275061098\n```\n\nNote that most parameters are autogenerated by the python package depending on the `short_name` and `version` you provide (downloadable, scroll, page_size, sort_key, concept_id). The other parameters are user defined (temporal, bounding_box)\n\nThere are many more additional parameters which can be passed. A complete list is present in the [documentation](https://cmr.earthdata.nasa.gov/search/site/docs/search/api.html). One such useful parameter that you can try out is `cloud_cover`. All you need to do is pass this parameter name with value to the `query` method in the above code.\n\n"},"formats":{"html":{"identifier":{"display-name":"HTML","target-format":"html","base-format":"html"},"execute":{"fig-width":7,"fig-height":5,"fig-format":"retina","fig-dpi":96,"df-print":"paged","error":false,"eval":true,"cache":null,"freeze":false,"echo":true,"output":true,"warning":true,"include":true,"keep-md":false,"keep-ipynb":false,"ipynb":null,"enabled":null,"daemon":null,"daemon-restart":false,"debug":false,"ipynb-filters":[],"engine":"markdown"},"render":{"keep-tex":false,"keep-source":false,"keep-hidden":false,"prefer-html":false,"output-divs":true,"output-ext":"html","fig-align":"default","fig-pos":null,"fig-env":null,"code-fold":"none","code-overflow":"wrap","code-link":false,"code-line-numbers":false,"code-tools":false,"tbl-colwidths":"auto","merge-includes":true,"inline-includes":false,"preserve-yaml":false,"latex-auto-mk":true,"latex-auto-install":true,"latex-clean":true,"latex-max-runs":10,"latex-makeindex":"makeindex","latex-makeindex-opts":[],"latex-tlmgr-opts":[],"latex-input-paths":[],"latex-output-dir":null,"link-external-icon":false,"link-external-newwindow":false,"self-contained-math":false,"format-resources":[],"notebook-links":true,"format-links":true},"pandoc":{"standalone":true,"wrap":"none","default-image-extension":"png","to":"html","css":["../../styles.css"],"toc":true,"output-file":"index.html"},"language":{"toc-title-document":"Table of contents","toc-title-website":"On this page","related-formats-title":"Other Formats","related-notebooks-title":"Notebooks","source-notebooks-prefix":"Source","section-title-abstract":"Abstract","section-title-appendices":"Appendices","section-title-footnotes":"Footnotes","section-title-references":"References","section-title-reuse":"Reuse","section-title-copyright":"Copyright","section-title-citation":"Citation","appendix-attribution-cite-as":"For attribution, please cite this work as:","appendix-attribution-bibtex":"BibTeX citation:","title-block-author-single":"Author","title-block-author-plural":"Authors","title-block-affiliation-single":"Affiliation","title-block-affiliation-plural":"Affiliations","title-block-published":"Published","title-block-modified":"Modified","callout-tip-title":"Tip","callout-note-title":"Note","callout-warning-title":"Warning","callout-important-title":"Important","callout-caution-title":"Caution","code-summary":"Code","code-tools-menu-caption":"Code","code-tools-show-all-code":"Show All Code","code-tools-hide-all-code":"Hide All Code","code-tools-view-source":"View Source","code-tools-source-code":"Source Code","code-line":"Line","code-lines":"Lines","copy-button-tooltip":"Copy to Clipboard","copy-button-tooltip-success":"Copied!","repo-action-links-edit":"Edit this page","repo-action-links-source":"View source","repo-action-links-issue":"Report an issue","back-to-top":"Back to top","search-no-results-text":"No results","search-matching-documents-text":"matching documents","search-copy-link-title":"Copy link to search","search-hide-matches-text":"Hide additional matches","search-more-match-text":"more match in this document","search-more-matches-text":"more matches in this document","search-clear-button-title":"Clear","search-detached-cancel-button-title":"Cancel","search-submit-button-title":"Submit","search-label":"Search","toggle-section":"Toggle section","toggle-sidebar":"Toggle sidebar navigation","toggle-dark-mode":"Toggle dark mode","toggle-reader-mode":"Toggle reader mode","toggle-navigation":"Toggle navigation","crossref-fig-title":"Figure","crossref-tbl-title":"Table","crossref-lst-title":"Listing","crossref-thm-title":"Theorem","crossref-lem-title":"Lemma","crossref-cor-title":"Corollary","crossref-prp-title":"Proposition","crossref-cnj-title":"Conjecture","crossref-def-title":"Definition","crossref-exm-title":"Example","crossref-exr-title":"Exercise","crossref-ch-prefix":"Chapter","crossref-apx-prefix":"Appendix","crossref-sec-prefix":"Section","crossref-eq-prefix":"Equation","crossref-lof-title":"List of Figures","crossref-lot-title":"List of Tables","crossref-lol-title":"List of Listings","environment-proof-title":"Proof","environment-remark-title":"Remark","environment-solution-title":"Solution","listing-page-order-by":"Order By","listing-page-order-by-default":"Default","listing-page-order-by-date-asc":"Oldest","listing-page-order-by-date-desc":"Newest","listing-page-order-by-number-desc":"High to Low","listing-page-order-by-number-asc":"Low to High","listing-page-field-date":"Date","listing-page-field-title":"Title","listing-page-field-description":"Description","listing-page-field-author":"Author","listing-page-field-filename":"File Name","listing-page-field-filemodified":"Modified","listing-page-field-subtitle":"Subtitle","listing-page-field-readingtime":"Reading Time","listing-page-field-categories":"Categories","listing-page-minutes-compact":"{0} min","listing-page-category-all":"All","listing-page-no-matches":"No matching items"},"metadata":{"lang":"en-GB","fig-responsive":true,"quarto-version":"1.3.450","theme":["sandstone","../../_variables.scss"],"page-layout":"article","fontsize":"1.1em","linestretch":1.7,"fontcolor":"black","author":[{"id":"cvc","number":1,"name":{"given":"Aman","family":"Bagrecha","literal":"Aman Bagrecha","non-dropping-particle":"von"},"orcid":"0000-0003-3131-0864","email":"jainaman588@gmail.com"}],"mermaid":{"theme":"neutral"},"title":"Download MODIS data using CMR API in Python","date":"2022-07-28","slug":"download-modis-data-using-cmr-api-in-python","categories":["Python"],"tags":[],"subtitle":"","lastmod":"2022-07-28T21:15:16+05:30","featured":"no","image":"featured.png"},"extensions":{"book":{"multiFile":true}}}},"projectFormats":["html"]}