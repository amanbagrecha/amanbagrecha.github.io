{"title":"Contour Maps in QGIS","markdown":{"yaml":{"title":"Contour Maps in QGIS","date":"2021-07-24","slug":"contour-maps-in-qgis","categories":["QGIS"],"tags":[],"description":"Generate contour maps in QGIS and understand various interpolation methods.","featured":"no"},"headingText":"Overview","containsRefs":false,"markdown":"\n\nMost of the time, we are equipped with a discrete set of sample points (of temperature, rainfall etc) and are tasked with generating a continuous surface.\nThis is where spatial interpolation comes into picture. The objective is to estimate the most probable value at an unknown location with a set of known points within the extent of sample points.\n\n\nMethods to perform spatial interpolation:\n1. TIN: Triangular Irregular Network forms contiguous, non-overlapping triangles by dividing the geographic space on set of sample points\n\n2. IDW: Inverse Distance Weighted interpolation method estimates cell values by weighted average of sample data. The closer the point, the more weight assigned. We can fix the radius of influence or the total sample points to weigh for cell value.\n\n3. Spline: Also called french curves. It uses a mathematical function that minimizes overall surface curvature, resulting in a smooth surface that passes through the input points.\n\n4. Kriging: A group of geostatistical techniques to interpolate the value of a random field at an unobserved location from observations of its value at a nearby location. It is implemented using semi-variogram.\n\nIn this blog, we create surface plots for Rainfall Correction Factors, which is indicative of how much the climate impacts a hydraulic structure based on the return period it is designed for.\n\nThese RCF are useful for hydraulic structures such as dams, storm water drains, and spillways.\nThese RCF are derived from Global Climate Models (GCMs) which models future scenarios. Not considering these factors can lead to reduced life time of the structure.\n\n\nWe calculate the RCF for each point for a grid of lat,lon around the indian subcontinent. These RCF are as a result of intensive computational simulations run in matlab which is out of scope for this blog.\n \n \n### 1. Load points in QGIS\n \nOur data is in the csv format with each column of the RP_ family representing the return period the Rainfall Correction Factor is estimated for. \n \n\n<figure>\n\n![](https://i.imgur.com/fZpYAK9.png)\n<figcaption align = \"center\"><b><i>Fig.1 -sample data points with key location and return period of RCF</i></b></figcaption>\n\n</figure>\n\n\n \nThis file can be imported into qgis from the layers panel and adding a delimited text layer. Once the layer is added, we export as shapefile so as to ease the process of automating the workflow which comes in handy later at the end of the blog.\n \n\n<figure>\n\n![](https://i.imgur.com/MvHcCZx.png)\n<figcaption align = \"center\"><b><i>Fig.2 -Add the csv file using Add delimited text layer</i></b></figcaption>\n\n</figure>\n\n\n \nWe load the sampled points and add an India boundary as the base vector to later clip the features to our area of Interest.\n\n<figure>\n\n![](https://i.imgur.com/IuoE9pb.png)\n<figcaption align = \"center\"><b><i>Fig.3 -Points equally spaced around the Indian state. Each point represent a RCF value</i></b></figcaption>\n\n</figure>\n\n \n \n### 2. Generate Raster from points using TIN interpolation\n\nFor demonstration let us take an example to run through the entire process of generating surface raster and styling which can be later automated using python in qgis.\n\nWe use these sampled locations of points to generate a surface using TIN Interpolation readily available as a toolbox in qgis. The input parameter for the vector layer is our shapefile of points while the interpolation attribute is going to be the RP_ family of columns. \n \n\n<figure>\n\n![](https://i.imgur.com/nzE5Vj7.png)\n<figcaption align = \"center\"><b><i>Fig.4 -TIN interpolation in QGIS</i></b></figcaption>\n\n</figure>\n\n \nThe output of the interpolation with pixel size of 0.01 is shown below. The extent was set to the boundary of Indian state. \n\n<figure>\n\n![](https://i.imgur.com/1HAjqQ4.png)\n<figcaption align = \"center\"><b><i>Fig.5 -Output surface raster with 0.01 pixel size</i></b></figcaption>\n\n</figure>\n\n\n \nWe can go a step further and derive contours using the `contour` toolbox provided in qgis.\n \n \n \n \n### 3. Generate Contours from raster to style the layer\n\n<figure>\n\n![](https://i.imgur.com/SOKxUmC.png)\n<figcaption align = \"center\"><b><i>Fig.6 -Generate contours from the surface raster</i></b></figcaption>\n\n</figure>\n\n \n\n<figure>\n\n![](https://i.imgur.com/ExfM0MM.png)\n<figcaption align = \"center\"><b><i>Fig.7 -Output as contour lines with 0.1 as interval</i></b></figcaption>\n\n</figure>\n\n \nA better way to get the contour lines is by changing the symbology of the raster to contours and providing an interval. This exact method will be employed later in this post.\n \n### Automating the process\n \nSo far we have looked into creating surface raster for an individual return period. But we have several other return periods and we do not want to repeat ourselves. Thus we write a tiny python code to automate this workflow.\n \nWe derive the RCFs for return period of 5year, 10year, 25year, 50year\n\n\n```python\n# specify the output location for saving the files\nOUTPATH = 'D:\\\\gcm_qgis\\\\'\n\n# loop over different return periods from the shapefile\nfor i,j in enumerate(['2y', '10y', '25y', '50y'], 3):\n\n    # specify the shapefile containing the RCP values\n    MYFILE = 'D:\\\\gcm_qgis\\\\RCP_avg.shp|layername=RCP_avg::~::0::~::{}::~::0'.format(i)\n\n    # Run interpolation and do not save the output permanently\n    RESULTS = processing.run(\"qgis:tininterpolation\", \n    {'INTERPOLATION_DATA': MYFILE,\n    'METHOD':1,\n    'EXTENT':'68.205600900,97.395561000,6.755997100,37.084107000 [EPSG:4326]',\n    'PIXEL_SIZE':0.01,\n    'OUTPUT':'TEMPORARY_OUTPUT'})\n\n    # clip the temporary output from prev step and save the files.\n    processing.runAndLoadResults(\"gdal:cliprasterbymasklayer\", \n    {'INPUT':RESULTS['OUTPUT'],\n    'MASK':'C:/Users/91911/Downloads/india-osm.geojson.txt|layername=india-osm.geojson',\n    'SOURCE_CRS':None,'TARGET_CRS':None,'NODATA':None,\n    'ALPHA_BAND':False,\n    'CROP_TO_CUTLINE':True,\n    'KEEP_RESOLUTION':False,'SET_RESOLUTION':False,'X_RESOLUTION':None,\n    'Y_RESOLUTION':None,\n    'MULTITHREADING':False,'OPTIONS':'',\n    'DATA_TYPE':0,\n    'EXTRA':'',\n    'OUTPUT':os.path.join(OUTPATH, 'RCP_avg_' + j + '.tif')})\n    iface.messageBar().pushMessage(\n        'Success:', 'Output file written at ', level=Qgis.Success)\n```\n\n\nOur output would save and display the contour files with RCP_avg_{return_period} where return period ranges from [2,5,10,25,50]\n\n\nThe code first fetches our shapefile, which is used to \n  1. create temporary TIN interpolation rasters\n  3. clipped to india boundary using `clip raster by mask layer`\n\n\nOnce we have the rasters for each return period, we style the raster using singleband pseudocolor in `Equal Interval` mode ranging from 1.0 - 1.8 in steps of 0.1\n\nWe make a copy of the raster layer and place it above it, giving it a contour style at an interval of 0.1 \n\nWe copy each return period and set the styling to be of contour as seen in the figure. This allows for a better visual representation of the regions with same the values. \n\n<figure>\n\n![](https://i.imgur.com/tz0DP0k.png)\n<figcaption align = \"center\"><b><i>Fig.8 -Styling the copy of surface raster</i></b></figcaption>\n\n</figure>\n\n\nThe final output can be seen in the below figure.\n\n<figure>\n\n![](https://i.imgur.com/fiX9RA9.png)\n<figcaption align = \"center\"><b><i>Fig.9 -Final output with contours overlaid on top of surface themself</i></b></figcaption>\n\n</figure>\n\n\n## Final comments\n\nWe looked at various spatial interpolation technique and automated workflow to derive spatially interpolated surface raster.\n\n\n\n\n\nSources:\n\na. [Comparison of Spatial Interpolation Techniques Using Visualization and Quantitative Assessment](https://www.intechopen.com/chapters/52704) \n\nb. [Spatial Analysis QGIS](https://docs.qgis.org/3.16/en/docs/gentle_gis_introduction/spatial_analysis_interpolation.html)\n","srcMarkdownNoYaml":"\n\n## Overview\nMost of the time, we are equipped with a discrete set of sample points (of temperature, rainfall etc) and are tasked with generating a continuous surface.\nThis is where spatial interpolation comes into picture. The objective is to estimate the most probable value at an unknown location with a set of known points within the extent of sample points.\n\n\nMethods to perform spatial interpolation:\n1. TIN: Triangular Irregular Network forms contiguous, non-overlapping triangles by dividing the geographic space on set of sample points\n\n2. IDW: Inverse Distance Weighted interpolation method estimates cell values by weighted average of sample data. The closer the point, the more weight assigned. We can fix the radius of influence or the total sample points to weigh for cell value.\n\n3. Spline: Also called french curves. It uses a mathematical function that minimizes overall surface curvature, resulting in a smooth surface that passes through the input points.\n\n4. Kriging: A group of geostatistical techniques to interpolate the value of a random field at an unobserved location from observations of its value at a nearby location. It is implemented using semi-variogram.\n\nIn this blog, we create surface plots for Rainfall Correction Factors, which is indicative of how much the climate impacts a hydraulic structure based on the return period it is designed for.\n\nThese RCF are useful for hydraulic structures such as dams, storm water drains, and spillways.\nThese RCF are derived from Global Climate Models (GCMs) which models future scenarios. Not considering these factors can lead to reduced life time of the structure.\n\n\nWe calculate the RCF for each point for a grid of lat,lon around the indian subcontinent. These RCF are as a result of intensive computational simulations run in matlab which is out of scope for this blog.\n \n \n### 1. Load points in QGIS\n \nOur data is in the csv format with each column of the RP_ family representing the return period the Rainfall Correction Factor is estimated for. \n \n\n<figure>\n\n![](https://i.imgur.com/fZpYAK9.png)\n<figcaption align = \"center\"><b><i>Fig.1 -sample data points with key location and return period of RCF</i></b></figcaption>\n\n</figure>\n\n\n \nThis file can be imported into qgis from the layers panel and adding a delimited text layer. Once the layer is added, we export as shapefile so as to ease the process of automating the workflow which comes in handy later at the end of the blog.\n \n\n<figure>\n\n![](https://i.imgur.com/MvHcCZx.png)\n<figcaption align = \"center\"><b><i>Fig.2 -Add the csv file using Add delimited text layer</i></b></figcaption>\n\n</figure>\n\n\n \nWe load the sampled points and add an India boundary as the base vector to later clip the features to our area of Interest.\n\n<figure>\n\n![](https://i.imgur.com/IuoE9pb.png)\n<figcaption align = \"center\"><b><i>Fig.3 -Points equally spaced around the Indian state. Each point represent a RCF value</i></b></figcaption>\n\n</figure>\n\n \n \n### 2. Generate Raster from points using TIN interpolation\n\nFor demonstration let us take an example to run through the entire process of generating surface raster and styling which can be later automated using python in qgis.\n\nWe use these sampled locations of points to generate a surface using TIN Interpolation readily available as a toolbox in qgis. The input parameter for the vector layer is our shapefile of points while the interpolation attribute is going to be the RP_ family of columns. \n \n\n<figure>\n\n![](https://i.imgur.com/nzE5Vj7.png)\n<figcaption align = \"center\"><b><i>Fig.4 -TIN interpolation in QGIS</i></b></figcaption>\n\n</figure>\n\n \nThe output of the interpolation with pixel size of 0.01 is shown below. The extent was set to the boundary of Indian state. \n\n<figure>\n\n![](https://i.imgur.com/1HAjqQ4.png)\n<figcaption align = \"center\"><b><i>Fig.5 -Output surface raster with 0.01 pixel size</i></b></figcaption>\n\n</figure>\n\n\n \nWe can go a step further and derive contours using the `contour` toolbox provided in qgis.\n \n \n \n \n### 3. Generate Contours from raster to style the layer\n\n<figure>\n\n![](https://i.imgur.com/SOKxUmC.png)\n<figcaption align = \"center\"><b><i>Fig.6 -Generate contours from the surface raster</i></b></figcaption>\n\n</figure>\n\n \n\n<figure>\n\n![](https://i.imgur.com/ExfM0MM.png)\n<figcaption align = \"center\"><b><i>Fig.7 -Output as contour lines with 0.1 as interval</i></b></figcaption>\n\n</figure>\n\n \nA better way to get the contour lines is by changing the symbology of the raster to contours and providing an interval. This exact method will be employed later in this post.\n \n### Automating the process\n \nSo far we have looked into creating surface raster for an individual return period. But we have several other return periods and we do not want to repeat ourselves. Thus we write a tiny python code to automate this workflow.\n \nWe derive the RCFs for return period of 5year, 10year, 25year, 50year\n\n\n```python\n# specify the output location for saving the files\nOUTPATH = 'D:\\\\gcm_qgis\\\\'\n\n# loop over different return periods from the shapefile\nfor i,j in enumerate(['2y', '10y', '25y', '50y'], 3):\n\n    # specify the shapefile containing the RCP values\n    MYFILE = 'D:\\\\gcm_qgis\\\\RCP_avg.shp|layername=RCP_avg::~::0::~::{}::~::0'.format(i)\n\n    # Run interpolation and do not save the output permanently\n    RESULTS = processing.run(\"qgis:tininterpolation\", \n    {'INTERPOLATION_DATA': MYFILE,\n    'METHOD':1,\n    'EXTENT':'68.205600900,97.395561000,6.755997100,37.084107000 [EPSG:4326]',\n    'PIXEL_SIZE':0.01,\n    'OUTPUT':'TEMPORARY_OUTPUT'})\n\n    # clip the temporary output from prev step and save the files.\n    processing.runAndLoadResults(\"gdal:cliprasterbymasklayer\", \n    {'INPUT':RESULTS['OUTPUT'],\n    'MASK':'C:/Users/91911/Downloads/india-osm.geojson.txt|layername=india-osm.geojson',\n    'SOURCE_CRS':None,'TARGET_CRS':None,'NODATA':None,\n    'ALPHA_BAND':False,\n    'CROP_TO_CUTLINE':True,\n    'KEEP_RESOLUTION':False,'SET_RESOLUTION':False,'X_RESOLUTION':None,\n    'Y_RESOLUTION':None,\n    'MULTITHREADING':False,'OPTIONS':'',\n    'DATA_TYPE':0,\n    'EXTRA':'',\n    'OUTPUT':os.path.join(OUTPATH, 'RCP_avg_' + j + '.tif')})\n    iface.messageBar().pushMessage(\n        'Success:', 'Output file written at ', level=Qgis.Success)\n```\n\n\nOur output would save and display the contour files with RCP_avg_{return_period} where return period ranges from [2,5,10,25,50]\n\n\nThe code first fetches our shapefile, which is used to \n  1. create temporary TIN interpolation rasters\n  3. clipped to india boundary using `clip raster by mask layer`\n\n\nOnce we have the rasters for each return period, we style the raster using singleband pseudocolor in `Equal Interval` mode ranging from 1.0 - 1.8 in steps of 0.1\n\nWe make a copy of the raster layer and place it above it, giving it a contour style at an interval of 0.1 \n\nWe copy each return period and set the styling to be of contour as seen in the figure. This allows for a better visual representation of the regions with same the values. \n\n<figure>\n\n![](https://i.imgur.com/tz0DP0k.png)\n<figcaption align = \"center\"><b><i>Fig.8 -Styling the copy of surface raster</i></b></figcaption>\n\n</figure>\n\n\nThe final output can be seen in the below figure.\n\n<figure>\n\n![](https://i.imgur.com/fiX9RA9.png)\n<figcaption align = \"center\"><b><i>Fig.9 -Final output with contours overlaid on top of surface themself</i></b></figcaption>\n\n</figure>\n\n\n## Final comments\n\nWe looked at various spatial interpolation technique and automated workflow to derive spatially interpolated surface raster.\n\n\n\n\n\nSources:\n\na. [Comparison of Spatial Interpolation Techniques Using Visualization and Quantitative Assessment](https://www.intechopen.com/chapters/52704) \n\nb. [Spatial Analysis QGIS](https://docs.qgis.org/3.16/en/docs/gentle_gis_introduction/spatial_analysis_interpolation.html)\n"},"formats":{"html":{"identifier":{"display-name":"HTML","target-format":"html","base-format":"html"},"execute":{"fig-width":7,"fig-height":5,"fig-format":"retina","fig-dpi":96,"df-print":"paged","error":false,"eval":true,"cache":null,"freeze":false,"echo":true,"output":true,"warning":true,"include":true,"keep-md":false,"keep-ipynb":false,"ipynb":null,"enabled":null,"daemon":null,"daemon-restart":false,"debug":false,"ipynb-filters":[],"engine":"markdown"},"render":{"keep-tex":false,"keep-source":false,"keep-hidden":false,"prefer-html":false,"output-divs":true,"output-ext":"html","fig-align":"default","fig-pos":null,"fig-env":null,"code-fold":"none","code-overflow":"wrap","code-link":false,"code-line-numbers":false,"code-tools":false,"tbl-colwidths":"auto","merge-includes":true,"inline-includes":false,"preserve-yaml":false,"latex-auto-mk":true,"latex-auto-install":true,"latex-clean":true,"latex-max-runs":10,"latex-makeindex":"makeindex","latex-makeindex-opts":[],"latex-tlmgr-opts":[],"latex-input-paths":[],"latex-output-dir":null,"link-external-icon":false,"link-external-newwindow":false,"self-contained-math":false,"format-resources":[],"notebook-links":true,"format-links":true},"pandoc":{"standalone":true,"wrap":"none","default-image-extension":"png","to":"html","css":["../../styles.css"],"toc":true,"output-file":"index.html"},"language":{"toc-title-document":"Table of contents","toc-title-website":"On this page","related-formats-title":"Other Formats","related-notebooks-title":"Notebooks","source-notebooks-prefix":"Source","section-title-abstract":"Abstract","section-title-appendices":"Appendices","section-title-footnotes":"Footnotes","section-title-references":"References","section-title-reuse":"Reuse","section-title-copyright":"Copyright","section-title-citation":"Citation","appendix-attribution-cite-as":"For attribution, please cite this work as:","appendix-attribution-bibtex":"BibTeX citation:","title-block-author-single":"Author","title-block-author-plural":"Authors","title-block-affiliation-single":"Affiliation","title-block-affiliation-plural":"Affiliations","title-block-published":"Published","title-block-modified":"Modified","callout-tip-title":"Tip","callout-note-title":"Note","callout-warning-title":"Warning","callout-important-title":"Important","callout-caution-title":"Caution","code-summary":"Code","code-tools-menu-caption":"Code","code-tools-show-all-code":"Show All Code","code-tools-hide-all-code":"Hide All Code","code-tools-view-source":"View Source","code-tools-source-code":"Source Code","code-line":"Line","code-lines":"Lines","copy-button-tooltip":"Copy to Clipboard","copy-button-tooltip-success":"Copied!","repo-action-links-edit":"Edit this page","repo-action-links-source":"View source","repo-action-links-issue":"Report an issue","back-to-top":"Back to top","search-no-results-text":"No results","search-matching-documents-text":"matching documents","search-copy-link-title":"Copy link to search","search-hide-matches-text":"Hide additional matches","search-more-match-text":"more match in this document","search-more-matches-text":"more matches in this document","search-clear-button-title":"Clear","search-detached-cancel-button-title":"Cancel","search-submit-button-title":"Submit","search-label":"Search","toggle-section":"Toggle section","toggle-sidebar":"Toggle sidebar navigation","toggle-dark-mode":"Toggle dark mode","toggle-reader-mode":"Toggle reader mode","toggle-navigation":"Toggle navigation","crossref-fig-title":"Figure","crossref-tbl-title":"Table","crossref-lst-title":"Listing","crossref-thm-title":"Theorem","crossref-lem-title":"Lemma","crossref-cor-title":"Corollary","crossref-prp-title":"Proposition","crossref-cnj-title":"Conjecture","crossref-def-title":"Definition","crossref-exm-title":"Example","crossref-exr-title":"Exercise","crossref-ch-prefix":"Chapter","crossref-apx-prefix":"Appendix","crossref-sec-prefix":"Section","crossref-eq-prefix":"Equation","crossref-lof-title":"List of Figures","crossref-lot-title":"List of Tables","crossref-lol-title":"List of Listings","environment-proof-title":"Proof","environment-remark-title":"Remark","environment-solution-title":"Solution","listing-page-order-by":"Order By","listing-page-order-by-default":"Default","listing-page-order-by-date-asc":"Oldest","listing-page-order-by-date-desc":"Newest","listing-page-order-by-number-desc":"High to Low","listing-page-order-by-number-asc":"Low to High","listing-page-field-date":"Date","listing-page-field-title":"Title","listing-page-field-description":"Description","listing-page-field-author":"Author","listing-page-field-filename":"File Name","listing-page-field-filemodified":"Modified","listing-page-field-subtitle":"Subtitle","listing-page-field-readingtime":"Reading Time","listing-page-field-categories":"Categories","listing-page-minutes-compact":"{0} min","listing-page-category-all":"All","listing-page-no-matches":"No matching items"},"metadata":{"lang":"en-GB","fig-responsive":true,"quarto-version":"1.3.450","theme":["sandstone","../../_variables.scss"],"page-layout":"article","fontsize":"1.1em","linestretch":1.7,"fontcolor":"black","author":[{"id":"cvc","number":1,"name":{"given":"Aman","family":"Bagrecha","literal":"Aman Bagrecha","non-dropping-particle":"von"},"orcid":"0000-0003-3131-0864","email":"jainaman588@gmail.com"}],"mermaid":{"theme":"neutral"},"title":"Contour Maps in QGIS","date":"2021-07-24","slug":"contour-maps-in-qgis","categories":["QGIS"],"tags":[],"description":"Generate contour maps in QGIS and understand various interpolation methods.","featured":"no"},"extensions":{"book":{"multiFile":true}}}},"projectFormats":["html"]}