{"title":"Validating LULC classes in QGIS","markdown":{"yaml":{"title":"Validating LULC classes in QGIS","date":"2021-06-09","slug":"validating-lulc-classes-in-qgis","categories":["QGIS","machine learning"],"tags":["qgis","machine learning"],"description":"The objective of this quality assessment was to validate the land cover map performed on June, 2020 sentinel-2 imagery by k-means classification algorithm in QGIS","featured":"no"},"headingText":"**The problem statement**","containsRefs":false,"markdown":"\n\n\n\nAny land-use land cover classification needs to be validated with ground-truth data to measure the accuracy. A key single-valued statistic to determine the effectiveness of classification is Cohen’s kappa. This validation metric has been fairly widely used for unbalanced classification as well which expresses a level of agreement between two annotators on a classification problem.\n\nThe objective of this quality assessment was to validate the land cover map performed on June, 2020 sentinel-2 imagery by k-means classification algorithm, thus providing a statistical measure of overall class predictions. The validation was done using an independent set of sample points (~500) generated randomly following stratified random sampling design, to capture the variance within the class\n\nAfter running the tool, the sample points were manually assigned to the ground-truth class. The ground-truth dataset was taken to be Bing-satellite imagery as a proxy for field data. Each sample point was labelled by visual inspection on the ground-truth dataset. \n\n## **Step 1: Classify Image**\n\n- Load raster Image\n- Open `K-means clustering for grids` under SAGA tools. Select the raster Image as `grid` and in this case we specify 4 classes\n\n<figure>\n\n![](https://i.imgur.com/xdx5Tsn.png)\n\n<figcaption align = \"center\"><b><i>Fig.1 -K-means clustering on sentinel-2 Image</i></b></figcaption>\n\n</figure>\n\n\n\n- Click `Run`\n\n> At this stage we have unsupervised k-means clustering output ready `(Fig.2)`.\n\n<figure>\n\n![](https://i.imgur.com/eW0cOXE.png)\n\n<figcaption align = \"center\"><b><i>Fig.2 -classification of RR Nagar, Bengaluru. Classes- Forest, Urban, water, Bareland</i></b></figcaption>\n\n</figure>\n\n\n\n---\n\n## **Step 2: Convert to polygon (vector format)**\n\n- Select `Polygonize (Raster to Vector)` tool under `GDAL`->`Raster Conversion`\n- Select the classified image as input. Leave everything else as default. The output would be a `Vectorised` scratch layer.\n\n<figure>\n\n![](https://i.imgur.com/36nk2tF.png)\n\n<figcaption align = \"center\"><b><i>Fig.3 -Convert Raster to vector</i></b></figcaption>\n\n</figure>\n\n> Note the name of the field (`DN` here). This will be used later.\n\n- Fix geometries (this step is important here to avoid any error in further steps) `Vector Geometry`->`Fix Geometry`\n\n<figure>\n\n![](https://i.imgur.com/gG9gBIc.png)\n\n<figcaption align = \"center\"><b><i>Fig.4 -Fixing topology issues with <code>Fix Geometry</code> Toolbox</i></b></figcaption>\n\n</figure>\n\n\n\n---\n\n## **Step 3: Dissolve the layer on DN field**\n\nIn this step we dissolve the layer based on the `DN` value. This will ensure that each polygon can be evaluated based on the land class type which is needed for stratified random sampling.\n\n<figure>\n\n![](https://i.imgur.com/gm1ihfT.png)\n\n<figcaption align = \"center\"><b><i>Fig.5 -<code>Dissolve</code> toolbox to dissolve polygon on <code> DN </code> value</i></b></figcaption>\n\n</figure>\n\n> Make sure to select dissolve field as `DN`\n\n---\n\n## **Step 4: Create stratified random samples**\n\nGo to `Vector->research tools-> Random Points inside Polygon` and set `Sampling Strategy` = `Points Density` and `Point count or density` = `0.001`.\n\nNote: The value `0.001` signify `1` point for `1/0.001` m2 of area, given that the units is meters. \n\n<figure>\n\n![](https://i.imgur.com/1LB6R5L.png)\n\n<figcaption align = \"center\"><b><i>Fig.6 - One sample point is generated for each 1000 m2 of area</i></b></figcaption>\n\n</figure>\n\n---\n\n## **Step 5: Extract raster values to sample layer**\n\nWe extract the raster value, which is essentially the land cover class for the classified image. We use `Sample Raster Values` function here (`Fig.7`). The input layer is the random points we generated earlier and the the raster layer is the classified image. The output adds a new column to the sample points layer with the prediction class of the land-cover (`Fig.8`). \n\n<figure>\n\n![](https://i.imgur.com/s2RXNOZ.png)\n\n<figcaption align = \"center\"><b><i>Fig.7 -Running <code>Sample Raster Value</code> to extract Raster values for the input points</i></b></figcaption>\n\n</figure>\n\n\n<figure>\n\n![](https://i.imgur.com/GG9wgNK.png)\n\n<figcaption align = \"center\"><b><i>Fig.8 -The corresponding Attribute Table with Predicted Class <code> PREDICTED_1</code> for each feature</i></b></figcaption>\n\n</figure>\n\n\n\n---\n\n## **Step 6: Ground Truth Labelling using Bing maps**\n\nAt this stage we are ready to validate the image using Bing maps as ground truth. We turn on the edit mode and create new field named Actual class. THen we visually inspect the class on the map and note the land-cover class. Once we inspect all the sample points we can use cohens Kappa statistics to determine the validation result. Alternatively, simply calculating the accuracy would also suffice the need.\n\n## **Step 7: Add other field to the attribute table with reclassification**\n\nWe can use the `Field Calculator` to generate verbose text for each label in our feature class and display labels for the prediction.\n\n```sql\n-- in field calculator to increase verbosity\nCASE WHEN PREDICTED_1 is 2 THEN 'Urban' \nWHEN PREDICTED_1 is 1 THEN 'Bareland'\nWHEN PREDICTED_1 is 4 THEN 'Forest'\nWHEN PREDICTED_1 is 3 THEN 'Urban'\nEND\n```\n\n<figure>\n\n![](https://i.imgur.com/3CBAK6X.jpg)\n\n<figcaption align = \"center\"><b><i>Fig.9 -Predicted classes (foreground) vs ground truth (background)</i></b></figcaption>\n\n</figure>\n\nWith this we come to end of the post. Now, validation accuracy can be reported for k-means classification.\n","srcMarkdownNoYaml":"\n\n\n## **The problem statement**\n\nAny land-use land cover classification needs to be validated with ground-truth data to measure the accuracy. A key single-valued statistic to determine the effectiveness of classification is Cohen’s kappa. This validation metric has been fairly widely used for unbalanced classification as well which expresses a level of agreement between two annotators on a classification problem.\n\nThe objective of this quality assessment was to validate the land cover map performed on June, 2020 sentinel-2 imagery by k-means classification algorithm, thus providing a statistical measure of overall class predictions. The validation was done using an independent set of sample points (~500) generated randomly following stratified random sampling design, to capture the variance within the class\n\nAfter running the tool, the sample points were manually assigned to the ground-truth class. The ground-truth dataset was taken to be Bing-satellite imagery as a proxy for field data. Each sample point was labelled by visual inspection on the ground-truth dataset. \n\n## **Step 1: Classify Image**\n\n- Load raster Image\n- Open `K-means clustering for grids` under SAGA tools. Select the raster Image as `grid` and in this case we specify 4 classes\n\n<figure>\n\n![](https://i.imgur.com/xdx5Tsn.png)\n\n<figcaption align = \"center\"><b><i>Fig.1 -K-means clustering on sentinel-2 Image</i></b></figcaption>\n\n</figure>\n\n\n\n- Click `Run`\n\n> At this stage we have unsupervised k-means clustering output ready `(Fig.2)`.\n\n<figure>\n\n![](https://i.imgur.com/eW0cOXE.png)\n\n<figcaption align = \"center\"><b><i>Fig.2 -classification of RR Nagar, Bengaluru. Classes- Forest, Urban, water, Bareland</i></b></figcaption>\n\n</figure>\n\n\n\n---\n\n## **Step 2: Convert to polygon (vector format)**\n\n- Select `Polygonize (Raster to Vector)` tool under `GDAL`->`Raster Conversion`\n- Select the classified image as input. Leave everything else as default. The output would be a `Vectorised` scratch layer.\n\n<figure>\n\n![](https://i.imgur.com/36nk2tF.png)\n\n<figcaption align = \"center\"><b><i>Fig.3 -Convert Raster to vector</i></b></figcaption>\n\n</figure>\n\n> Note the name of the field (`DN` here). This will be used later.\n\n- Fix geometries (this step is important here to avoid any error in further steps) `Vector Geometry`->`Fix Geometry`\n\n<figure>\n\n![](https://i.imgur.com/gG9gBIc.png)\n\n<figcaption align = \"center\"><b><i>Fig.4 -Fixing topology issues with <code>Fix Geometry</code> Toolbox</i></b></figcaption>\n\n</figure>\n\n\n\n---\n\n## **Step 3: Dissolve the layer on DN field**\n\nIn this step we dissolve the layer based on the `DN` value. This will ensure that each polygon can be evaluated based on the land class type which is needed for stratified random sampling.\n\n<figure>\n\n![](https://i.imgur.com/gm1ihfT.png)\n\n<figcaption align = \"center\"><b><i>Fig.5 -<code>Dissolve</code> toolbox to dissolve polygon on <code> DN </code> value</i></b></figcaption>\n\n</figure>\n\n> Make sure to select dissolve field as `DN`\n\n---\n\n## **Step 4: Create stratified random samples**\n\nGo to `Vector->research tools-> Random Points inside Polygon` and set `Sampling Strategy` = `Points Density` and `Point count or density` = `0.001`.\n\nNote: The value `0.001` signify `1` point for `1/0.001` m2 of area, given that the units is meters. \n\n<figure>\n\n![](https://i.imgur.com/1LB6R5L.png)\n\n<figcaption align = \"center\"><b><i>Fig.6 - One sample point is generated for each 1000 m2 of area</i></b></figcaption>\n\n</figure>\n\n---\n\n## **Step 5: Extract raster values to sample layer**\n\nWe extract the raster value, which is essentially the land cover class for the classified image. We use `Sample Raster Values` function here (`Fig.7`). The input layer is the random points we generated earlier and the the raster layer is the classified image. The output adds a new column to the sample points layer with the prediction class of the land-cover (`Fig.8`). \n\n<figure>\n\n![](https://i.imgur.com/s2RXNOZ.png)\n\n<figcaption align = \"center\"><b><i>Fig.7 -Running <code>Sample Raster Value</code> to extract Raster values for the input points</i></b></figcaption>\n\n</figure>\n\n\n<figure>\n\n![](https://i.imgur.com/GG9wgNK.png)\n\n<figcaption align = \"center\"><b><i>Fig.8 -The corresponding Attribute Table with Predicted Class <code> PREDICTED_1</code> for each feature</i></b></figcaption>\n\n</figure>\n\n\n\n---\n\n## **Step 6: Ground Truth Labelling using Bing maps**\n\nAt this stage we are ready to validate the image using Bing maps as ground truth. We turn on the edit mode and create new field named Actual class. THen we visually inspect the class on the map and note the land-cover class. Once we inspect all the sample points we can use cohens Kappa statistics to determine the validation result. Alternatively, simply calculating the accuracy would also suffice the need.\n\n## **Step 7: Add other field to the attribute table with reclassification**\n\nWe can use the `Field Calculator` to generate verbose text for each label in our feature class and display labels for the prediction.\n\n```sql\n-- in field calculator to increase verbosity\nCASE WHEN PREDICTED_1 is 2 THEN 'Urban' \nWHEN PREDICTED_1 is 1 THEN 'Bareland'\nWHEN PREDICTED_1 is 4 THEN 'Forest'\nWHEN PREDICTED_1 is 3 THEN 'Urban'\nEND\n```\n\n<figure>\n\n![](https://i.imgur.com/3CBAK6X.jpg)\n\n<figcaption align = \"center\"><b><i>Fig.9 -Predicted classes (foreground) vs ground truth (background)</i></b></figcaption>\n\n</figure>\n\nWith this we come to end of the post. Now, validation accuracy can be reported for k-means classification.\n"},"formats":{"html":{"identifier":{"display-name":"HTML","target-format":"html","base-format":"html"},"execute":{"fig-width":7,"fig-height":5,"fig-format":"retina","fig-dpi":96,"df-print":"paged","error":false,"eval":true,"cache":null,"freeze":false,"echo":true,"output":true,"warning":true,"include":true,"keep-md":false,"keep-ipynb":false,"ipynb":null,"enabled":null,"daemon":null,"daemon-restart":false,"debug":false,"ipynb-filters":[],"engine":"markdown"},"render":{"keep-tex":false,"keep-source":false,"keep-hidden":false,"prefer-html":false,"output-divs":true,"output-ext":"html","fig-align":"default","fig-pos":null,"fig-env":null,"code-fold":"none","code-overflow":"wrap","code-link":false,"code-line-numbers":false,"code-tools":false,"tbl-colwidths":"auto","merge-includes":true,"inline-includes":false,"preserve-yaml":false,"latex-auto-mk":true,"latex-auto-install":true,"latex-clean":true,"latex-max-runs":10,"latex-makeindex":"makeindex","latex-makeindex-opts":[],"latex-tlmgr-opts":[],"latex-input-paths":[],"latex-output-dir":null,"link-external-icon":false,"link-external-newwindow":false,"self-contained-math":false,"format-resources":[],"notebook-links":true,"format-links":true},"pandoc":{"standalone":true,"wrap":"none","default-image-extension":"png","to":"html","css":["../../styles.css"],"toc":true,"output-file":"index.html"},"language":{"toc-title-document":"Table of contents","toc-title-website":"On this page","related-formats-title":"Other Formats","related-notebooks-title":"Notebooks","source-notebooks-prefix":"Source","section-title-abstract":"Abstract","section-title-appendices":"Appendices","section-title-footnotes":"Footnotes","section-title-references":"References","section-title-reuse":"Reuse","section-title-copyright":"Copyright","section-title-citation":"Citation","appendix-attribution-cite-as":"For attribution, please cite this work as:","appendix-attribution-bibtex":"BibTeX citation:","title-block-author-single":"Author","title-block-author-plural":"Authors","title-block-affiliation-single":"Affiliation","title-block-affiliation-plural":"Affiliations","title-block-published":"Published","title-block-modified":"Modified","callout-tip-title":"Tip","callout-note-title":"Note","callout-warning-title":"Warning","callout-important-title":"Important","callout-caution-title":"Caution","code-summary":"Code","code-tools-menu-caption":"Code","code-tools-show-all-code":"Show All Code","code-tools-hide-all-code":"Hide All Code","code-tools-view-source":"View Source","code-tools-source-code":"Source Code","code-line":"Line","code-lines":"Lines","copy-button-tooltip":"Copy to Clipboard","copy-button-tooltip-success":"Copied!","repo-action-links-edit":"Edit this page","repo-action-links-source":"View source","repo-action-links-issue":"Report an issue","back-to-top":"Back to top","search-no-results-text":"No results","search-matching-documents-text":"matching documents","search-copy-link-title":"Copy link to search","search-hide-matches-text":"Hide additional matches","search-more-match-text":"more match in this document","search-more-matches-text":"more matches in this document","search-clear-button-title":"Clear","search-detached-cancel-button-title":"Cancel","search-submit-button-title":"Submit","search-label":"Search","toggle-section":"Toggle section","toggle-sidebar":"Toggle sidebar navigation","toggle-dark-mode":"Toggle dark mode","toggle-reader-mode":"Toggle reader mode","toggle-navigation":"Toggle navigation","crossref-fig-title":"Figure","crossref-tbl-title":"Table","crossref-lst-title":"Listing","crossref-thm-title":"Theorem","crossref-lem-title":"Lemma","crossref-cor-title":"Corollary","crossref-prp-title":"Proposition","crossref-cnj-title":"Conjecture","crossref-def-title":"Definition","crossref-exm-title":"Example","crossref-exr-title":"Exercise","crossref-ch-prefix":"Chapter","crossref-apx-prefix":"Appendix","crossref-sec-prefix":"Section","crossref-eq-prefix":"Equation","crossref-lof-title":"List of Figures","crossref-lot-title":"List of Tables","crossref-lol-title":"List of Listings","environment-proof-title":"Proof","environment-remark-title":"Remark","environment-solution-title":"Solution","listing-page-order-by":"Order By","listing-page-order-by-default":"Default","listing-page-order-by-date-asc":"Oldest","listing-page-order-by-date-desc":"Newest","listing-page-order-by-number-desc":"High to Low","listing-page-order-by-number-asc":"Low to High","listing-page-field-date":"Date","listing-page-field-title":"Title","listing-page-field-description":"Description","listing-page-field-author":"Author","listing-page-field-filename":"File Name","listing-page-field-filemodified":"Modified","listing-page-field-subtitle":"Subtitle","listing-page-field-readingtime":"Reading Time","listing-page-field-categories":"Categories","listing-page-minutes-compact":"{0} min","listing-page-category-all":"All","listing-page-no-matches":"No matching items"},"metadata":{"lang":"en-GB","fig-responsive":true,"quarto-version":"1.3.450","theme":["sandstone","../../_variables.scss"],"page-layout":"article","fontsize":"1.1em","linestretch":1.7,"fontcolor":"black","author":[{"id":"cvc","number":1,"name":{"given":"Aman","family":"Bagrecha","literal":"Aman Bagrecha","non-dropping-particle":"von"},"orcid":"0000-0003-3131-0864","email":"jainaman588@gmail.com"}],"mermaid":{"theme":"neutral"},"title":"Validating LULC classes in QGIS","date":"2021-06-09","slug":"validating-lulc-classes-in-qgis","categories":["QGIS","machine learning"],"tags":["qgis","machine learning"],"description":"The objective of this quality assessment was to validate the land cover map performed on June, 2020 sentinel-2 imagery by k-means classification algorithm in QGIS","featured":"no"},"extensions":{"book":{"multiFile":true}}}},"projectFormats":["html"]}